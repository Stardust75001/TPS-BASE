{% comment %}
  Auto-generated by Shogun.
  This file can be re-written at any time.
{% endcomment %}

{% assign template_suffix = template.suffix %}

{% if article %}
  {% assign content = article %}
{% elsif page %}
  {% assign content = page %}
{% elsif product %}
  {% assign content = product %}
{% elsif collection %}
  {% assign content = collection %}
{% endif %}

{% capture cfh_buffer %}
  {% render 'shogun-products', content: content %}
{% endcapture %}

{% if content.metafields.shogun.json_template_snippets %}
  {% capture cfh_buffer %}
    {{ cfh_buffer }}
    {{ content.metafields.shogun.json_template_snippets.value['head'][template_suffix] }}
  {% endcapture %}

  {% capture content_for_layout %}
    {{ content_for_layout }}
    {{ content.metafields.shogun.json_template_snippets.value['body'][template_suffix] }}
  {% endcapture %}
{% endif %}

{% if content.metafields.shogun.json_template_html_wrapper %}
  {% assign json_template_config = content.metafields.shogun.json_template_html_wrapper.value %}
  {% capture content_for_layout %}
    {{
        json_template_config.html
        | replace: json_template_config.content_for_layout_placeholder, content_for_layout
        | replace: json_template_config.page_variant_id_placeholder, json_template_config.template_suffix_to_variant_id_map[template_suffix]
    }}
  {% endcapture %}
{% endif %}

{% if content.metafields.shogun.json_template_optimizer %}
  {% capture cfh_buffer %}
        <template id="shogun-variant-head">
          {{ cfh_buffer }}
        </template>
        <script type="text/javascript">
          {% if customer %}
            window.SHG_CUSTOMER = { "id": "{{ customer.id }}" }
          {% else %}
            window.SHG_CUSTOMER = null;
          {% endif %}
        </script>
        {{ content.metafields.shogun.json_template_optimizer.value['head'] }}
     {% endcapture %}

  {% capture content_for_layout %}
        <template id="shogun-variant-body">
          {{ content_for_layout }}
        </template>
        {{ content.metafields.shogun.json_template_optimizer.value['body'] }}
     {% endcapture %}
{% endif %}

{%- comment -%} Expose buffered head markup via a namespaced variable without mutating content_for_header {%- endcomment -%}
{% assign shogun_head_markup = cfh_buffer %}
<template id="shogun-head-buffer" data-origin="shogun-content-handler" hidden>
  {{ shogun_head_markup }}
</template>
